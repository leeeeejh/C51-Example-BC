C51 COMPILER V8.02   0                                                                     07/16/2010 19:42:55 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE 0
OBJECT MODULE PLACED IN 0.OBJ
COMPILER INVOKED BY: D:\Èí¼þ\Ñ§Ï°Èí¼þ\keil3\C51\BIN\C51.EXE 0.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***************************************************************
   2                                                  ¡°ÌìÏéµç×Ó¡±            ÇãÇé·îÏ×
   3                                                                  www.txmcu.com
   4                                                                  www.txmcu.cn
   5          *****************************************************************
   6          ³ÌÐò¹¦ÄÜ£º  ÓÉÓÚ24c02ÊÇÃ¿¸ö´æ´¢µØÖ·Ö»¶ÔÓ¦8¸öbitµÄ´æ´¢¿Õ¼ä£¬¼´Ò»¸ö
   7                                  ´æ´¢µ¥ÔªËù´æ´¢µÄÊý¾Ý×î´óÎª255£¬¸ÃÀý³Ì½éÉÜÁËÒ»ÖÖµ±Ëù¼ÇÒä
   8                                  Êý¾Ý´óÓÚ255£¨¶øÐ¡ÓÚ65536£©µÄ´æ´¢·½·¨¡£¼´ÓÃÁ½¸ö´æ´¢µ¥ÔªÀ´
   9                                  ´æ´¢Ò»¸öÊý¾Ý¡£
  10                                  ÏÂÔØ³ÌÐòºó£¬ÊýÂë¹Ü»áÏÔÊ¾ËùÉè¶¨µÄnumÖµ£¨´Ë´¦ÉèÎª12345£©¡£
  11          ***************************************************************/
  12          
  13          #include<reg51.h>
  14          #include <intrins.h>
  15          #define uint unsigned int
  16          #define uchar unsigned char
  17          uint num,num1,num2;        //¶¨Òå¼ÆÊýÖµ£¬Ã¿¹ý1Ãë£¬sec¼Ó1
  18          sbit sda=P2^0;                          //IO¿Ú¶¨Òå
  19          sbit scl=P2^1;
  20          sbit dula=P2^6;
  21          sbit wela=P2^7;
  22          sbit s1=P3^4;//¼ÆÊý°´¼ü
  23          sbit s2=P3^5;//ÇåÁã°´¼ü
  24          unsigned char j,k;
  25          char a,b,c,d,e;
  26          
  27          void delay(unsigned char i)             //ÑÓÊ±³ÌÐò
  28          {
  29   1        for(j=i;j>0;j--)
  30   1          for(k=125;k>0;k--);
  31   1      }
  32          
  33          uchar code table[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,                         //ÊýÂë¹Ü±àÂë
  34                                  0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};
  35          
  36          void nop()
  37          {
  38   1              _nop_();
  39   1              _nop_();
  40   1      }
  41          void display(uchar a,b,c,d,e)                   //ÏÔÊ¾³ÌÐò
  42          {
  43   1         dula=0;
  44   1         P0=table[a];         //ÏÔÊ¾ÍòÎ»
  45   1         dula=1;
  46   1         dula=0;
  47   1      
  48   1         wela=0;
  49   1         P0=0xfe;
  50   1         wela=1;
  51   1         wela=0;
  52   1         delay(5);
  53   1      
  54   1         dula=0;
  55   1         P0=table[b];         //ÏÔÊ¾Ç§Î»
C51 COMPILER V8.02   0                                                                     07/16/2010 19:42:55 PAGE 2   

  56   1         dula=1;
  57   1         dula=0;
  58   1      
  59   1         wela=0;
  60   1         P0=0xfd;
  61   1         wela=1;
  62   1         wela=0;
  63   1         delay(5);
  64   1      
  65   1         dula=0;
  66   1         P0=table[c];         //ÏÔÊ¾°ÙÎ»
  67   1         dula=1;
  68   1         dula=0;
  69   1      
  70   1         wela=0;
  71   1         P0=0xfb;
  72   1         wela=1;
  73   1         wela=0;
  74   1         delay(5);
  75   1      
  76   1         dula=0;
  77   1         P0=table[d];         //ÏÔÊ¾Ê®Î»
  78   1         dula=1;
  79   1         dula=0;
  80   1      
  81   1         wela=0;
  82   1         P0=0xf7;
  83   1         wela=1;
  84   1         wela=0;
  85   1         delay(5);
  86   1      
  87   1         dula=0;
  88   1         P0=table[e];         //ÏÔÊ¾¸öÎ»
  89   1         dula=1;
  90   1         dula=0;
  91   1      
  92   1         wela=0;
  93   1         P0=0xef;
  94   1         wela=1;
  95   1         wela=0;
  96   1         delay(5);
  97   1               
  98   1      }
  99          
 100          /////////24C02¶ÁÐ´Çý¶¯³ÌÐò////////////////////
 101          void delay1(unsigned int m)
 102          {       unsigned int n;
 103   1              for(n=0;n<m;n++);
 104   1      }
 105          
 106          void init()  //24c02³õÊ¼»¯×Ó³ÌÐò
 107          {
 108   1              scl=1;
 109   1              nop();
 110   1              sda=1;
 111   1              nop();
 112   1      }
 113          
 114          void start()        //Æô¶¯I2C×ÜÏß
 115          {
 116   1              sda=1;
 117   1              nop();
C51 COMPILER V8.02   0                                                                     07/16/2010 19:42:55 PAGE 3   

 118   1              scl=1;
 119   1              nop();
 120   1              sda=0;
 121   1              nop();
 122   1              scl=0;
 123   1              nop();
 124   1      }
 125          
 126          void stop()         //Í£Ö¹I2C×ÜÏß
 127          {
 128   1              sda=0;
 129   1              nop();
 130   1              scl=1;
 131   1              nop();
 132   1              sda=1;
 133   1              nop();
 134   1      }
 135          
 136          void writebyte(unsigned char j)  //Ð´Ò»¸ö×Ö½Ú
 137          {
 138   1              unsigned char i,temp;
 139   1              temp=j;
 140   1              for (i=0;i<8;i++)
 141   1         {
 142   2                 temp=temp<<1;
 143   2                 scl=0;
 144   2                 nop();
 145   2                 sda=CY;              //temp×óÒÆÊ±£¬ÒÆ³öµÄÖµ·ÅÈëÁËCYÖÐ
 146   2                 nop();
 147   2                 scl=1;               //´ýsdaÏßÉÏµÄÊý¾ÝÎÈ¶¨ºó£¬½«sclÀ­¸ß
 148   2                 nop();
 149   2         }
 150   1         scl=0;
 151   1         nop();
 152   1         sda=1;
 153   1         nop();
 154   1      }
 155          
 156          unsigned char readbyte()   //¶ÁÒ»¸ö×Ö½Ú
 157          {
 158   1         unsigned char i,j,k=0;
 159   1         scl=0; nop(); sda=1;
 160   1         for (i=0;i<8;i++)
 161   1         {  
 162   2                      nop(); scl=1; nop();
 163   2              if(sda==1) 
 164   2                      j=1;
 165   2              else
 166   2                      j=0;
 167   2              k=(k<<1)|j;
 168   2                      scl=0;
 169   2              }
 170   1              nop();
 171   1              return(k);
 172   1      }
 173          
 174          void clock()         //I2C×ÜÏßÊ±ÖÓ
 175          {
 176   1         unsigned char i=0;
 177   1         scl=1;
 178   1         nop();
 179   1         while((sda==1)&&(i<255))
C51 COMPILER V8.02   0                                                                     07/16/2010 19:42:55 PAGE 4   

 180   1                i++;
 181   1         scl=0;
 182   1         nop();
 183   1      }
 184          
 185          ////////´Ó24c02µÄµØÖ·addressÖÐ¶ÁÈ¡Ò»¸ö×Ö½ÚÊý¾Ý/////
 186          unsigned char read24c02(unsigned char address)
 187          {
 188   1         unsigned char i;
 189   1         start();
 190   1         writebyte(0xa0);
 191   1         clock();
 192   1         writebyte(address);
 193   1         clock();
 194   1         start();
 195   1         writebyte(0xa1);
 196   1         clock();
 197   1         i=readbyte();
 198   1         stop();
 199   1         delay1(100);
 200   1         return(i);
 201   1      }
 202          
 203          //////Ïò24c02µÄaddressµØÖ·ÖÐÐ´ÈëÒ»×Ö½ÚÊý¾Ýinfo/////
 204          void write24c02(unsigned char address,unsigned char info)
 205          {
 206   1         start();
 207   1         writebyte(0xa0);
 208   1         clock();
 209   1         writebyte(address);
 210   1         clock();
 211   1         writebyte(info);
 212   1         clock();
 213   1         stop();
 214   1         delay1(5000); //Õâ¸öÑÓÊ±Ò»¶¨Òª×ã¹»³¤£¬·ñÔò»á³ö´í¡£ÒòÎª24c02ÔÚ´ÓsdaÉÏÈ¡µÃÊý¾Ýºó£¬»¹ÐèÒªÒ»¶¨Ê±¼äµÄÉÕÂ¼¹ý³
             -Ì¡£
 215   1      }
 216          
 217          void main()
 218          {
 219   1              init();        //³õÊ¼»¯24C02
 220   1              num=12345;         //numÎªÐ¡ÓÚµÈÓÚ65535µÄÕûÊý¡£
 221   1              num2=num/256;
 222   1              num1=num%256;
 223   1              write24c02(0,num1);
 224   1              write24c02(1,num2);
 225   1              num1=read24c02(0);      //ÓÃµØÖ·0µ¥Ôª´æ´¢numÊ®Áù½øÖÆ±íÊ¾Ê±µÄµÍÁ½Î»
 226   1              num2=read24c02(1);      //ÓÃµØÖ·0µ¥Ôª´æ´¢numÊ®Áù½øÖÆ±íÊ¾Ê±µÄ¸ßÁ½Î»
 227   1              num=num2*256+num1;
 228   1              a=num/10000;
 229   1              b=num%10000/1000;
 230   1              c=num%1000/100;
 231   1              d=num%100/10;
 232   1              e=num%10;
 233   1              while(1)
 234   1              display(a,b,c,d,e);
 235   1      }
 236          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    618    ----
C51 COMPILER V8.02   0                                                                     07/16/2010 19:42:55 PAGE 5   

   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
